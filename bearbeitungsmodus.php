<?php// diese PHP-Datei ist die Bearbeitungsmaske// das hier ist wieder die rekursive Funktion mit der alles als Baum ausgegeben wird ( hier zusätzlich mit der Möglichkeit den Namen einer Kategorie zu ändern)function gib_baumstruktur_als_EditListe($kategorie, $parent_id=0){  echo '<ul>';     foreach($kategorie as $key=>$value){	    if($value['parent_id']==$parent_id){		      echo '<li id="list'.$value['id'].'" title='.$value['url'].'>';	 	   	  echo $value['name'];	  echo "<span id=\"".$value['id']."\"  onclick=\"InsertDown(".$value['id'].")\"><img title=\"neue Kategorie einfügen\" src=\"img/insert_down.jpg\" /></span>";	  echo "<span id=\"".$value['id']."\"  onclick=\"changeURL(".$value['id'].", '".$value['url']."')\"><img title=\"URL ändern\" src=\"img/change_url.jpg\" /></span>";	  echo "<span id=\"".$value['id']."\"  onclick=\"changeNameTree(".$value['id'].", '".$value['name']."')\"><img title=\"umbenennen\" src=\"img/rename.jpg\" /></span>";	  echo "<span id=\"".$value['id']."\"  onclick=\"delete_in_tree(".$value['id'].", '".$value['name']."')\"><img title=\"löschen\" src=\"img/delete.png\" /></span>";	  	       gib_baumstruktur_als_EditListe($kategorie, $value['id']);      echo '</li>';    }  }  echo '</ul>';} ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>	<link rel="stylesheet" type="text/css" href="_styles.css" media="screen">	<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">	<script type="text/javascript" src="https://code.jquery.com/jquery-1.8.0.min.js"></script></head><body><h1>URL-Finder</h1><br/><div id="editieren"><h2>Bearbeitungsmodus</h2><br/><!--BAUM_Edit-Bereich -- START--><br/><input type="button" id="tree" value="TREE-Modus (BETA)" class="editbutton" /><div id="treemaske"><h3>Mithilfe des Baumes arbeiten</h3>	<?php	include_once('db_connect.php');$connection=connect();		$resource = mysql_query('select * from kategorien');  $kategorie = array();while($row = mysql_fetch_assoc($resource)){    $kategorie[$row['id']] = $row;} echo"<div id='baum_liste'>";echo "<span id=\"obenEinfuegen\"  onclick='InsertDown(\"keine\")'><img title=\"neue Kategorie einfügen\" src=\"img/insert_down.jpg\" /></span>";gib_baumstruktur_als_EditListe($kategorie); echo"</div>";    mysql_close($connection);		?><br/><br/><br/></div><!--BAUM_Edit-Bereich -- ENDE--><br/><br/><br/><div class="zentrierung"><a href="urlfinder.php" ><img src="img/back.png" class="editimg" width="5%" height="5%" alt="back"/> zur&uuml;ck</a></div></div><script type="text/javascript">// ----------------------------------TREE BETA   START-------------------------// folgende Funktionen ermöglichen das Editieren der Elemente direkt im übersichtlichen Baum//Diese Funktion ändert den Namen einer Kategorie, indem sie per Ajax die Datei neue_werte_in_db.php aufruft und dort die 3te if-bedingung erfülltfunction changeNameTree(id, oldName){var newName=window.prompt("Neuer Name:", oldName);if(newName != null) // Fixxing Abbrechen-Bug{//Ajax-STARTif (window.XMLHttpRequest)  {// code for IE7+, Firefox, Chrome, Opera, Safari  xmlhttp4=new XMLHttpRequest();  }else  {// code for IE6, IE5  xmlhttp4=new ActiveXObject("Microsoft.XMLHTTP");  }xmlhttp4.onreadystatechange=function()  {  if (xmlhttp4.readyState==4 && xmlhttp4.status==200)    {				document.getElementById("list"+id).childNodes.item(0).nodeValue=newName; //hier wird die Seite nicht neugeladen, sondern direkt der Wert ausgetauscht		//alert(xmlhttp4.responseText);	}  }xmlhttp4.open("GET","neue_werte_in_db.php?id="+id+"&neuer_name=ok&parentID_choice_3="+id+"&neuerName3_name="+newName,true);xmlhttp4.send();}//window.setTimeout("location.reload()", 100);}// Diese Funktion fügt neue Unterkategorien in den Baum einfunction InsertDown(id){var newKatName=window.prompt("Name der Kategorie:");if(newKatName != null) // Fixxing Abbrechen-Bug{//Ajax-STARTif (window.XMLHttpRequest)  {// code for IE7+, Firefox, Chrome, Opera, Safari  xmlhttp5=new XMLHttpRequest();  }else  {// code for IE6, IE5  xmlhttp5=new ActiveXObject("Microsoft.XMLHTTP");  }xmlhttp5.onreadystatechange=function()  {  if (xmlhttp5.readyState==4 && xmlhttp5.status==200)    {				window.location.href = "bearbeitungsmodus.php";		document.getElementById("list"+id).childNodes.item(2).nextSibling.innerHTML=newKatName; //hier wird die Seite nicht neugeladen, sondern direkt der Wert ausgetauscht		//das würde auch funzen, allerdings wenn man die gerade eingegeben Kat löschen will, wird stattdessen die Überkat gelöscht -> nicht vertretbar		//stattdessen:			}  }xmlhttp5.open("GET","neue_werte_in_db.php?neueKat=ok&parentID_choice_1="+id+"&neueKategorie1_name="+newKatName,true);xmlhttp5.send();}}//das ist auch Ajax, allerdings über jQuery gelöst; hier wird die url im tree geändertfunction changeURL(id, oldURLName){var newURLName=window.prompt("neue URL:", oldURLName);if(newURLName != null) // Fixxing Abbrechen-Bug{	$.ajax({		type: "GET",		url: "neue_werte_in_db.php",		data: { id: id, parentID_choice_2: id, neueURL: "ok", neueURL2_name: newURLName }	}).done(function( ) {		//alert( "Data Saved: ");		document.getElementById("list"+id).title=newURLName; //hier wird die Seite nicht neugeladen, sondern direkt der Wert ausgetauscht		});}}//hier wird die kategore über den tree gelöschtfunction delete_in_tree(id, name){var answer=window.confirm( unescape("Wollen Sie wirklich die Kategorie '"+name+"' sowie all ihre Unterkategorien löschen?") ); //unescape um Umlaute darstellen zu könnenif(answer==true) // Fixxing Abbrechen-Bug{	$.ajax({		type: "GET",		url: "neue_werte_in_db.php",		data: { parentID_choice_4: id, delKat:"ok" }	}).done(function( ) {		//alert( "Data Saved: ");				$("#list"+id).css('display', 'none');				var Anzahl = document.getElementById("list"+id).childNodes.length;				for(var i = 0; i <= Anzahl; i++)		{			$("#list"+id).childNodes[i].css('display', 'none');		}				//var Erster = document.getElementById("derText").childNodes[0].nodeValue;		//document.getElementById("list"+id).title=newURLName; //hier wird die Seite nicht neugeladen, sondern direkt der Wert ausgetauscht		});}}// ----------------------------------TREE BETA  ENDE-------------------------</script></body></html>							